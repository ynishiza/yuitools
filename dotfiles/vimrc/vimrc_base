"
" My vimrc file
"

"---------------------------------------------------------------
"						OPTIONS
"

" Filetype options
"
" - plugin
" - indent
filetype plugin on 
filetype indent on

"
"set background=dark

"  omni complete
set omnifunc=syntaxcomplete#Complete

" Tabs
set smarttab
set autoindent
set tabstop=4
set shiftwidth=4

" Backspace
" - use backspace to delete eol, indents, and start of an insert.
set backspace=eol,indent,start

" Timeout
" - ttimeout: timeout on key code
set ttimeout
set ttimeoutlen=100

" list (invisibile characters)
set listchars=tab:>-,eol:$,nbsp:Â»

" wildmenu
" - smarter tab completion in commandline
set wildmenu


" Display line numbers in editor.
set number


" Indent automatically on new line.
set autoindent

"
" Status
"
" show status bar.
set laststatus=2
set statusline=""
" show line and column number.
set ruler

" Fold			
"set foldmethod=syntax
set foldmethod=manual
"let javaScript_fold=1

" History
if &history < 1000
	set history=1000
endif

" Scrolloff
" - minimal lines to keep visible
if !&scrolloff
	set scrolloff=1
endif
if !&sidescrolloff
	set sidescrolloff=1
endif


"
" Ctags
"
" Where to look for tag files
set tags=./tags,./ctags


" Syntax highlighting.
syntax enable 


"
" Search
"
" Highlight matches.
set hlsearch
" Highlight as I type.
set incsearch
"set ignorecase


"---------------------------------------------------------------
"					 Language specific 
"

" Comment term in the script
let t:comment_term="//"
let t:comment_term_end=""

function! InitVim()
	let t:comment_term="\""
endfunction

function! InitPython()
    "echo "python"
	let t:comment_term="#"
    set autoindent
    " Use spaces instead of tabs
	" set expandtab
    " 4 spaces
    set tabstop=4
    set shiftwidth=4
	set softtabstop=4
	set textwidth=79
	call PythonWithSpaces(4)
endfunction

function! InitPHP()
	let g:myvar="php"
	let t:comment_term="//"
endfunction

function! InitJs()
	let t:comment_term="//"
	call JSWithTabs()
endfunction

function! InitCss() 
	let t:comment_term="/\\* "
	let t:comment_term_end=" \\*/"
endfunction

function! InitBash()
	let t:comment_term="#"
endfunction

function! InitR()
	let t:comment_term="#"
	set expandtab
	set tabstop=2
	set shiftwidth=2
endfunction

function! InitMakefile()
	let t:comment_term="#"
endfunction

function! InitGitmerge()
	" local
	nmap <leader>dl :diffget 1<cr>
	" remote
	nmap <leader>dr :diffget 3<cr>
endfunction

"
function! CommentInsert()
	"execute "'<,'>s=^=" . t:comment_term . "="
	if exists("t:comment_term")
		execute "s=^=" . t:comment_term . "="
	endif
	if exists("t:comment_term_end")
		execute "s=\\(.*\\)=\\1" . t:comment_term_end . "=" 
	endif
endfunction
function! CommentRemove()
	if exists("t:comment_term")
		execute "s=^" . t:comment_term . "=="
	endif
	"execute "'<,'>s=^" . t:comment_term . "=="
	if exists("t:comment_term_end")
		execute "s=" . t:comment_term_end . "$=="
	endif
endfunction

function! InitMarkdown()
	set expandtab
	set tabstop=2
	set shiftwidth=2
endfunction

function! MyTestFunct()
	s/abc/ABC/gc
endfunction

autocmd FileType vim call InitVim()
autocmd FileType python call InitPython()
autocmd FileType php call InitPHP()
autocmd FileType javascript call InitJs()
autocmd FileType r call InitR()
autocmd FileType sh call InitBash()
autocmd FileType make call InitMakefile()
autocmd FileType markdown call InitMarkdown()
autocmd Filetype css call InitCss()

" Manually recognize filetypes
autocmd BufRead *.md set filetype=markdown
autocmd BufRead *.json set filetype=json
autocmd BufRead *.rst set filetype=markdown

"
" Language specific settings
"

" Python 
function! PythonWithSpaces(x)
	set expandtab
	let &tabstop=a:x
	let &shiftwidth=a:x
endfunction
function! PythonWithTabs()
	set noexpandtab
	set tabstop=4
	set shiftwidth=4
endfunction

" JavaScript 
function! JSWithSpaces(x)
	set expandtab
	let &tabstop=a:x
	let &shiftwidth=a:x
endfunction
function! JSWithTabs()
	set noexpandtab
	set tabstop=4
	set shiftwidth=4
endfunction

function! RemoveTrailingWhitespace()
	execute "%s/\\s\\+$//g"
endfunction


"---------------------------------------------------------------
"					  MAPPING	
"
imap <c-c> <ESC>
imap <c-k> <ESC>

" Save with <c-s>
map <c-s> :w<CR>
imap <c-s> <ESC>:w<CR>
" Close with <c-q>
" Doesn't work?
"map <c-w> :tabc<CR>
"imap <c-w> <ESC>:tabc<CR>

" Clipboard
"
" - mac only? + registry is clipboard
" copy/paste
vmap <c-c> "+y		
nmap <c-v> "+p
imap <c-v> <ESC>"+p
" select all
nmap <c-a> gg^vGG$		

" My commands
"
" - Leader
let mapleader="\<space>"
let maplocalleader=","
map <leader>s :w<CR>
map <leader>w :tabclose<CR>
map <leader>l :so $MYVIMRC<cr>
" Search for word under cursor.
map <leader>f /<c-r>=expand("<cword>")<cr>
" Search and replace word under cursor.
map <leader>r :%s/\<<c-r>=expand("<cword>")<cr>\>
map <leader>g :vimgrep /\<<c-r>=expand("<cword>")<cr>\>/ 
" Shortcuts for my functions
map <leader>c :call CommentInsert()<cr>
map <leader>C :call CommentRemove()<cr>


"---------------------------------------------------------------
"						PLUGINS
" 						
"
" Taglist
"
" See the ctags file.
let tlist_markdown_settings="markdown;h:header"
let tlist_r_settings = "r;f:function;c:class"
let tlist_php_settings="php;f:function;d:constant;a:class"
let tlist_javascript_settings_base = "javascript;e:class;d:class_property;q:constant;r:@module;n:@property;t:@class;o:@method;u:@construct;j:describe;k:it"
let tlist_javascript_settings = tlist_javascript_settings_base . ";f:function"
map <F8> :TlistToggle<CR>



"---------------------------------------------------------------
"						MISC
"

"
" LoadCustomVim : 
"
function! LoadCustomVim() 
	let mod = ":h"
	let dir = expand("%:p" . mod)

	" Default vimrc.
	let myvimrc = resolve(expand("$MYVIMRC"))
	"echo myvimrc
	"
	while dir != "/" 
		let file = dir . "/.vimrc"

		" Expand to full path
		let fullfile = resolve(expand(file))
"		echo file

		" Found vimrc.
		" - Ignore default vimrc.
		if filereadable(file) && fullfile != myvimrc
			"echo "Found custom vim: " . file
			let g:custom_vimrc=file
			execute "so " file ""
			break
		endif

		let mod = mod . ":h"
		let dir = expand("%:p" . mod)
	endwhile
endfunction
call LoadCustomVim()



"---------------------------------------------------------------
"						Include
" neobundle
so $HOME/.vimrc_yui/vimrc_neobundle
so $HOME/.vimrc_yui/vimrc_syntastic
